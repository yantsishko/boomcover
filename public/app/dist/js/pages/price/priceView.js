define(["app","marionette","backbone","underscore","pace","text!templates/price/index.ejs","helpers"],function(e,i,t,a,r,p,l){"use strict";return i.LayoutView.extend({template:a.template(p),ui:{},events:{},onShow:function(){var e=l.getData("/api/v1/current_user"),i=l.getData("/api/v1/payment/price/1/1"),a=l.getData("/api/v1/payment/price/1/5"),r=l.getData("/api/v1/payment/price/1/10"),p=l.getData("/api/v1/payment/price/1/20");i.original_price!==i.price&&t.$("#discountTitle").html("Сейчас действует акция, скидка 30%"),t.$('#one-groups input[name="sum"]').val(i.price),i.original_price!==i.price?t.$("#priceTotal").html('<p class="discount"><strike style="font-size: 20px;">'+i.original_price+"</strike>"+i.price+'<br><i class="fa fa-ruble"></i></p>'):t.$("#priceTotal").html("<p>"+i.price+'<i class="fa fa-ruble"></i></p>'),t.$('#five-groups input[name="sum"]').val(a.price),a.original_price!==a.price?t.$("#priceTotal5").html('<p class="discount"><strike style="font-size: 20px;">'+a.original_price+"</strike>"+a.price+'<br><i class="fa fa-ruble"></i></p>'):t.$("#priceTotal5").html("<p>"+a.price+'<i class="fa fa-ruble"></i></p>'),t.$('#ten-groups input[name="sum"]').val(r.price),r.original_price!==r.price?t.$("#priceTotal10").html('<p class="discount"><strike style="font-size: 20px;">'+r.original_price+"</strike>"+r.price+'<br><i class="fa fa-ruble"></i></p>'):t.$("#priceTotal10").html("<p>"+r.price+'<i class="fa fa-ruble"></i></p>'),t.$('#twenty-groups input[name="sum"]').val(p.price),p.original_price!==p.price?t.$("#priceTotal20").html('<p class="discount"><strike style="font-size: 20px;">'+p.original_price+"</strike>"+p.price+'<br><i class="fa fa-ruble"></i></p>'):t.$("#priceTotal20").html("<p>"+p.price+'<i class="fa fa-ruble"></i></p>'),"error"===e&&(window.location="/login"),Array.from(document.querySelectorAll("[name=customerNumber]")).map(function(i){i.value=e.id});var n=1,c=1,s=t.$("#priceTotal");t.$(".btn-number").click(function(e){e.preventDefault();var i=t.$(this).attr("data-field"),a=t.$(this).attr("data-type"),r=t.$("input[name='"+i+"']"),p=document.querySelector("input[name='groupsCount']"),o=document.querySelector("input[name='monthsCount']"),u=document.querySelector("input[name='sum']"),m=parseInt(r.val());isNaN(m)?r.val(0):"minus"==a?(m>r.attr("min")&&("groupCount"===i?(n=m-1,p.value=n,r.val(n).change()):(c=m-1,o.value=c,r.val(c).change())),parseInt(r.val())==r.attr("min")?t.$(this).attr("disabled",!0):t.$(this).attr("disabled",!1)):"plus"==a&&(m<r.attr("max")&&("groupCount"===i?(n=m+1,p.value=n,r.val(n).change()):(c=m+1,o.value=c,r.val(c).change())),parseInt(r.val())==r.attr("max")?t.$(this).attr("disabled",!0):t.$('[data-type="minus"]').attr("disabled",!1));var d=l.getData("/api/v1/payment/price/"+c+"/"+n);d.original_price!==d.price?s.html('<p class="discount"><strike style="font-size: 20px;">'+d.original_price+"</strike>"+d.price+'<br><i class="fa fa-ruble"></i></p>'):s.html("<p>"+d.price+'<i class="fa fa-ruble"></i></p>'),u.value=d.price}),t.$(".input-number").focusin(function(){t.$(this).data("oldValue",t.$(this).val())}),t.$(".input-number").keydown(function(e){-1!==t.$.inArray(e.keyCode,[46,8,9,27,13,190])||65==e.keyCode&&!0===e.ctrlKey||e.keyCode>=35&&e.keyCode<=39||(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()})}})});